(function(m,L){function H(){}function B(g,b){if(g){"object"==typeof g&&(g=[].slice.call(g));for(var c=0,d=g.length;c<d;c++)b.call(g,g[c],c)}}function ea(g,b){var c=Object.prototype.toString.call(b).slice(8,-1);return b!==L&&null!==b&&c===g}function t(b){return ea("Function",b)}function v(b){return ea("Array",b)}function T(b){(b=b||H,b._done)||(b(),b._done=1)}function f(b){var c={},d,h;if("object"==typeof b)for(d in b)!b[d]||(c={name:d,url:b[d]});else c=b.split("/"),c=c[c.length-1],d=c.indexOf("?"),
c={name:-1!==d?c.substring(0,d):c,url:b};return(h=N[c.name],h&&h.url===c.url)?h:(N[c.name]=c,c)}function k(b){b=b||N;for(var c in b)if(b.hasOwnProperty(c)&&b[c].state!==S)return!1;return!0}function U(b){b.state=O;B(b.onpreload,function(b){b.call()})}function d(b){b.state===L&&(b.state=Da,b.onpreload=[],ma({url:b.url,type:"cache"},function(){U(b)}))}function n(){var c=arguments,R=c[c.length-1],h=[].slice.call(c,1),n=h[0];return(t(R)||(R=null),v(c[0]))?(c[0].push(R),r.load.apply(null,c[0]),r):(n?(B(h,
function(b){t(b)||!b||d(f(b))}),b(f(c[0]),t(n)?n:function(){r.load.apply(null,h)})):b(f(c[0])),r)}function c(){var c=arguments,d=c[c.length-1],h={};return(t(d)||(d=null),v(c[0]))?(c[0].push(d),r.load.apply(null,c[0]),r):(B(c,function(b){b!==d&&(b=f(b),h[b.name]=b)}),B(c,function(c){c!==d&&(c=f(c),b(c,function(){k(h)&&T(d)}))}),r)}function b(c,d){(d=d||H,c.state===S)?d():c.state===na?r.ready(c.name,d):c.state===Da?c.onpreload.push(function(){b(c,d)}):(c.state=na,ma(c,function(){c.state=S;d();B(z[c.name],
function(c){T(c)});V&&k()&&B(z.ALL,function(c){T(c)})}))}function y(c){c=(c||"").split("?")[0].split(".");return c[c.length-1].toLowerCase()}function ma(c,b){function d(c){k.onload=k.onreadystatechange=k.onerror=null;b()}function h(C){C=C||m.event;("load"===C.type||/loaded|complete/.test(k.readyState)&&(!s.documentMode||9>s.documentMode))&&(m.clearTimeout(c.errorTimeout),m.clearTimeout(c.cssTimeout),k.onload=k.onreadystatechange=k.onerror=null,b())}function n(){if(c.state!==S&&20>=c.cssRetries){for(var b=
0,ua=s.styleSheets.length;b<ua;b++)if(s.styleSheets[b].href===k.href){h({type:"load"});return}c.cssRetries++;c.cssTimeout=m.setTimeout(n,250)}}var k,f;b=b||H;"css"===y(c.url)?(k=s.createElement("link"),k.type="text/"+(c.type||"css"),k.rel="stylesheet",k.href=c.url,c.cssRetries=0,c.cssTimeout=m.setTimeout(n,500)):(k=s.createElement("script"),k.type="text/"+(c.type||"javascript"),k.src=c.url);k.onload=k.onreadystatechange=h;k.onerror=d;k.async=!1;k.defer=!1;c.errorTimeout=m.setTimeout(function(){d({type:"timeout"})},
7E3);f=s.head||s.getElementsByTagName("head")[0];f.insertBefore(k,f.lastChild)}function E(){for(var c,b=s.getElementsByTagName("script"),d=0,h=b.length;d<h;d++)if(c=b[d].getAttribute("data-headjs-load"),c){r.load(c);break}}function h(){s.body?V||(V=!0,E(),B(F,function(c){T(c)})):(m.clearTimeout(r.readyTimeout),r.readyTimeout=m.setTimeout(h,50))}function w(){s.addEventListener?(s.removeEventListener("DOMContentLoaded",w,!1),h()):"complete"===s.readyState&&(s.detachEvent("onreadystatechange",w),h())}
var s=m.document,F=[],z={},N={},K="async"in s.createElement("script")||"MozAppearance"in s.documentElement.style||m.opera,V,W=m.head_conf&&m.head_conf.head||"sbz_head",r=m[W]=m[W]||function(){r.ready.apply(null,arguments)},Da=1,O=2,na=3,S=4,$;if("complete"===s.readyState)h();else if(s.addEventListener)s.addEventListener("DOMContentLoaded",w,!1),m.addEventListener("load",h,!1);else{s.attachEvent("onreadystatechange",w);m.attachEvent("onload",h);$=!1;try{$=!m.frameElement&&s.documentElement}catch(pa){}$&&
$.doScroll&&function R(){if(!V){try{$.doScroll("left")}catch(c){m.clearTimeout(r.readyTimeout);r.readyTimeout=m.setTimeout(R,50);return}h()}}()}r.load=r.js=K?c:n;r.test=function(c,b,d,h){c="object"==typeof c?c:{test:c,success:b?v(b)?b:[b]:!1,failure:d?v(d)?d:[d]:!1,callback:h||H};b=!!c.test;return b&&c.success?(c.success.push(c.callback),r.load.apply(null,c.success)):b||!c.failure?h():(c.failure.push(c.callback),r.load.apply(null,c.failure)),r};r.ready=function(c,b){var d,h,n;return c===s?(V?T(b):
F.push(b),r):(t(c)&&(b=c,c="ALL"),v(c))?(d={},B(c,function(c){d[c]=N[c];r.ready(c,function(){k(d)&&T(b)})}),r):"string"==typeof c&&t(b)?(h=N[c],h&&h.state===S||"ALL"===c&&k()&&V)?(T(b),r):(n=z[c],n?n.push(b):n=z[c]=[b],r):r};r.ready(s,function(){k()&&B(z.ALL,function(c){T(c)});r.feature&&r.feature("domloaded",!0)})})(window);
(function(m){function L(v,t){function f(c){if(f[c]!==s)return f[c];var b;if("bug-string-char-index"==c)b="a"!="a"[0];else if("json"==c)b=f("json-stringify")&&f("json-parse");else{var d;if("json-stringify"==c){b=t.stringify;var h="function"==typeof b&&F;if(h){(d=function(){return 1}).toJSON=d;try{h="0"===b(0)&&"0"===b(new k)&&'""'==b(new B)&&b(E)===s&&b(s)===s&&b()===s&&"1"===b(d)&&"[1]"==b([d])&&"[null]"==b([s])&&"null"==b(null)&&"[null,null,null]"==b([s,E,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==
b({a:[d,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===b(null,d)&&"[\n 1,\n 2\n]"==b([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==b(new n(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==b(new n(864E13))&&'"-000001-01-01T00:00:00.000Z"'==b(new n(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==b(new n(-1))}catch(g){h=!1}}b=h}if("json-parse"==c){b=t.parse;if("function"==typeof b)try{if(0===b("0")&&!b(!1)){d=b('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var m=5==d.a.length&&1===d.a[0];if(m){try{m=!b('"\t"')}catch(J){}if(m)try{m=
1!==b("01")}catch(u){}if(m)try{m=1!==b("1.")}catch(Ra){}}}}catch(Sa){m=!1}b=m}}return f[c]=!!b}v||(v=m.Object());t||(t=m.Object());var k=v.Number||m.Number,B=v.String||m.String,d=v.Object||m.Object,n=v.Date||m.Date,c=v.SyntaxError||m.SyntaxError,b=v.TypeError||m.TypeError,y=v.Math||m.Math,H=v.JSON||m.JSON;"object"==typeof H&&H&&(t.stringify=H.stringify,t.parse=H.parse);var d=d.prototype,E=d.toString,h,w,s,F=new n(-0xc782b5b800cec);try{F=-109252==F.getUTCFullYear()&&0===F.getUTCMonth()&&1===F.getUTCDate()&&
10==F.getUTCHours()&&37==F.getUTCMinutes()&&6==F.getUTCSeconds()&&708==F.getUTCMilliseconds()}catch(z){}if(!f("json")){var N=f("bug-string-char-index");if(!F)var K=y.floor,V=[0,31,59,90,120,151,181,212,243,273,304,334],W=function(c,b){return V[b]+365*(c-1970)+K((c-1969+(b=+(1<b)))/4)-K((c-1901+b)/100)+K((c-1601+b)/400)};(h=d.hasOwnProperty)||(h=function(c){var b={},d;(b.__proto__=null,b.__proto__={toString:1},b).toString!=E?h=function(c){var b=this.__proto__;c=c in(this.__proto__=null,this);this.__proto__=
b;return c}:(d=b.constructor,h=function(c){var b=(this.constructor||d).prototype;return c in this&&!(c in b&&this[c]===b[c])});b=null;return h.call(this,c)});var r={"boolean":1,number:1,string:1,undefined:1};w=function(c,b){var d=0,g,k,n;(g=function(){this.valueOf=0}).prototype.valueOf=0;k=new g;for(n in k)h.call(k,n)&&d++;g=k=null;d?w=2==d?function(c,b){var d={},C="[object Function]"==E.call(c),g;for(g in c)C&&"prototype"==g||h.call(d,g)||!(d[g]=1)||!h.call(c,g)||b(g)}:function(c,b){var d="[object Function]"==
E.call(c),C,g;for(C in c)d&&"prototype"==C||!h.call(c,C)||(g="constructor"===C)||b(C);(g||h.call(c,C="constructor"))&&b(C)}:(k="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),w=function(c,b){var d="[object Function]"==E.call(c),C,g;if(g=!d)if(g="function"!=typeof c.constructor)g=typeof c.hasOwnProperty,g="object"==g?!!c.hasOwnProperty:!r[g];g=g?c.hasOwnProperty:h;for(C in c)d&&"prototype"==C||!g.call(c,C)||b(C);for(d=k.length;C=k[--d];g.call(c,
C)&&b(C));});return w(c,b)};if(!f("json-stringify")){var ea={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},O=function(c,b){return("000000"+(b||0)).slice(-c)},na=function(c){for(var b='"',d=0,g=c.length,h=!N||10<g,k=h&&(N?c.split(""):c);d<g;d++){var J=c.charCodeAt(d);switch(J){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=ea[J];break;default:if(32>J){b+="\\u00"+O(2,J.toString(16));break}b+=h?k[d]:c.charAt(d)}}return b+'"'},S=function(c,d,g,k,n,m,J){var u,f,r,t,v,y,z,B,A;
try{u=d[c]}catch(F){}if("object"==typeof u&&u)if(f=E.call(u),"[object Date]"!=f||h.call(u,"toJSON"))"function"==typeof u.toJSON&&("[object Number]"!=f&&"[object String]"!=f&&"[object Array]"!=f||h.call(u,"toJSON"))&&(u=u.toJSON(c));else if(u>-1/0&&u<1/0){if(W){t=K(u/864E5);for(f=K(t/365.2425)+1970-1;W(f+1,0)<=t;f++);for(r=K((t-W(f,0))/30.42);W(f,r+1)<=t;r++);t=1+t-W(f,r);v=(u%864E5+864E5)%864E5;y=K(v/36E5)%24;z=K(v/6E4)%60;B=K(v/1E3)%60;v%=1E3}else f=u.getUTCFullYear(),r=u.getUTCMonth(),t=u.getUTCDate(),
y=u.getUTCHours(),z=u.getUTCMinutes(),B=u.getUTCSeconds(),v=u.getUTCMilliseconds();u=(0>=f||1E4<=f?(0>f?"-":"+")+O(6,0>f?-f:f):O(4,f))+"-"+O(2,r+1)+"-"+O(2,t)+"T"+O(2,y)+":"+O(2,z)+":"+O(2,B)+"."+O(3,v)+"Z"}else u=null;g&&(u=g.call(d,c,u));if(null===u)return"null";f=E.call(u);if("[object Boolean]"==f)return""+u;if("[object Number]"==f)return u>-1/0&&u<1/0?""+u:"null";if("[object String]"==f)return na(""+u);if("object"==typeof u){for(c=J.length;c--;)if(J[c]===u)throw b();J.push(u);A=[];d=m;m+=n;if("[object Array]"==
f){r=0;for(c=u.length;r<c;r++)f=S(r,u,g,k,n,m,J),A.push(f===s?"null":f);c=A.length?n?"[\n"+m+A.join(",\n"+m)+"\n"+d+"]":"["+A.join(",")+"]":"[]"}else w(k||u,function(c){var b=S(c,u,g,k,n,m,J);b!==s&&A.push(na(c)+":"+(n?" ":"")+b)}),c=A.length?n?"{\n"+m+A.join(",\n"+m)+"\n"+d+"}":"{"+A.join(",")+"}":"{}";J.pop();return c}};t.stringify=function(c,b,d){var g,h,k,n;if("function"==typeof b||"object"==typeof b&&b)if("[object Function]"==(n=E.call(b)))h=b;else if("[object Array]"==n){k={};for(var f=0,m=
b.length,r;f<m;r=b[f++],(n=E.call(r),"[object String]"==n||"[object Number]"==n)&&(k[r]=1));}if(d)if("[object Number]"==(n=E.call(d))){if(0<(d-=d%1))for(g="",10<d&&(d=10);g.length<d;g+=" ");}else"[object String]"==n&&(g=10>=d.length?d:d.slice(0,10));return S("",(r={},r[""]=c,r),h,k,g,"",[])}}if(!f("json-parse")){var $=B.fromCharCode,pa={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},g,R,A=function(){g=R=null;throw c();},M=function(){for(var c=R,b=c.length,d,h,k,n,f;g<b;)switch(f=
c.charCodeAt(g),f){case 9:case 10:case 13:case 32:g++;break;case 123:case 125:case 91:case 93:case 58:case 44:return d=N?c.charAt(g):c[g],g++,d;case 34:d="@";for(g++;g<b;)if(f=c.charCodeAt(g),32>f)A();else if(92==f)switch(f=c.charCodeAt(++g),f){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:d+=pa[f];g++;break;case 117:h=++g;for(k=g+4;g<k;g++)f=c.charCodeAt(g),48<=f&&57>=f||97<=f&&102>=f||65<=f&&70>=f||A();d+=$("0x"+c.slice(h,g));break;default:A()}else{if(34==f)break;f=c.charCodeAt(g);
for(h=g;32<=f&&92!=f&&34!=f;)f=c.charCodeAt(++g);d+=c.slice(h,g)}if(34==c.charCodeAt(g))return g++,d;A();default:h=g;45==f&&(n=!0,f=c.charCodeAt(++g));if(48<=f&&57>=f){for(48==f&&(f=c.charCodeAt(g+1),48<=f&&57>=f)&&A();g<b&&(f=c.charCodeAt(g),48<=f&&57>=f);g++);if(46==c.charCodeAt(g)){for(k=++g;k<b&&(f=c.charCodeAt(k),48<=f&&57>=f);k++);k==g&&A();g=k}f=c.charCodeAt(g);if(101==f||69==f){f=c.charCodeAt(++g);43!=f&&45!=f||g++;for(k=g;k<b&&(f=c.charCodeAt(k),48<=f&&57>=f);k++);k==g&&A();g=k}return+c.slice(h,
g)}n&&A();if("true"==c.slice(g,g+4))return g+=4,!0;if("false"==c.slice(g,g+5))return g+=5,!1;if("null"==c.slice(g,g+4))return g+=4,null;A()}return"$"},ta=function(c){var b,d;"$"==c&&A();if("string"==typeof c){if("@"==(N?c.charAt(0):c[0]))return c.slice(1);if("["==c){for(b=[];;d||(d=!0)){c=M();if("]"==c)break;d&&(","==c?(c=M(),"]"==c&&A()):A());","==c&&A();b.push(ta(c))}return b}if("{"==c){for(b={};;d||(d=!0)){c=M();if("}"==c)break;d&&(","==c?(c=M(),"}"==c&&A()):A());","!=c&&"string"==typeof c&&"@"==
(N?c.charAt(0):c[0])&&":"==M()||A();b[c.slice(1)]=ta(M())}return b}A()}return c},Ea=function(c,b,d){d=Fa(c,b,d);d===s?delete c[b]:c[b]=d},Fa=function(c,b,d){var f=c[b],g;if("object"==typeof f&&f)if("[object Array]"==E.call(f))for(g=f.length;g--;)Ea(f,g,d);else w(f,function(c){Ea(f,c,d)});return d.call(c,b,f)};t.parse=function(c,b){var d,f;g=0;R=""+c;d=ta(M());"$"!=M()&&A();g=R=null;return b&&"[object Function]"==E.call(b)?Fa((f={},f[""]=d,f),"",b):d}}}t.runInContext=L;return t}var H="function"===
typeof define&&define.amd,B="object"==typeof global&&global;!B||B.global!==B&&B.window!==B||(m=B);if("object"!=typeof exports||!exports||exports.nodeType||H){var ea=m.JSON,t=L(m,m.JSON3={noConflict:function(){m.JSON=ea;return t}});m.JSON={parse:t.parse,stringify:t.stringify}}else L(m,exports);H&&define(function(){return t})})(this);"undefined"!=typeof subiz_account_id&&0<subiz_account_id&&!window._sbzq&&(window._sbzq=[["_setAccount",subiz_account_id]]);
(function(m){var L=JSON3.noConflict(),H=sbz_head,B=function(a,c){return c()}(this,function(){var a=function(a){a=a||{};for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c])};a.prototype={constructor:a,newWindow:!0,stripPrefix:!0,twitter:!0,email:!0,urls:!0,className:"",matcherRegex:function(){var a=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,c=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/;
return new RegExp(["(",/(^|[^\w])@(\w{1,15})/.source,")|(",/(?:[\-;:&=\+\$,\w\.]+@)/.source,a.source,c.source,")|((?:(?:",/(?:[A-Za-z]{3,9}:(?:\/\/)?)/.source,a.source,")|(?:(.?//)?",/(?:www\.)/.source,a.source,")|(?:(.?//)?",a.source,c.source,"))",/(?:[\-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|])?/.source,")"].join(""),"gi")}(),protocolRelativeRegex:/(.)?\/\//,htmlRegex:new RegExp(["<(/)?","("+/[0-9a-zA-Z:]+/.source+")","(?:\\s+",/[^\s\0"'>\/=\x01-\x1F\x7F]+/.source,"(?:\\s*=\\s*"+
/(?:".*?"|'.*?'|[^'"=<>`\s]+)/.source+")?",")*\\s*>"].join(""),"g"),urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,link:function(a){return this.processHtml(a)},processHtml:function(a){for(var c=this.htmlRegex,b,d,e=0,f=0,g=[];null!==(b=c.exec(a));){var l=b[0],h=b[2],k=!!b[1];d=a.substring(e,b.index);e=b.index+l.length;"a"===h?k?(f=Math.max(f-1,0),0===f&&g.push(d)):(f++,g.push(this.processTextNode(d))):0===f?g.push(this.processTextNode(d)):g.push(d);g.push(l)}e<a.length&&(a=this.processTextNode(a.substring(e)),
g.push(a));return g.join("")},processTextNode:function(a){var c=this,b=this.twitter,d=this.email,e=this.urls;return a.replace(this.matcherRegex,function(a,q,f,g,l,h,k,Ja){var n=k||Ja;Ja=k="";if(q&&!b||l&&!d||h&&!e||h&&-1===h.indexOf(".")||h&&/^[A-Za-z]{3,9}:/.test(h)&&!/:.*?[A-Za-z]/.test(h)||n&&/^[\w]\/\//.test(n))return a;if(")"===a.charAt(a.length-1)){h=a.match(/\(/g);var p=a.match(/\)/g);(h&&h.length||0)<(p&&p.length||0)&&(a=a.substr(0,a.length-1),Ja=")")}h=a;q?(q="twitter",k=f,h="https://twitter.com/"+
g,a="@"+g):l?(q="email",h="mailto:"+l,a=l):(q="url",n?(f=new RegExp("^"+c.protocolRelativeRegex.source),k=(n.match(f)[1]||"")+k,h=h.replace(f,"//"),a=a.replace(f,"")):/^[A-Za-z]{3,9}:/i.test(h)||(h="http://"+h));f=c.createAnchorTag(q,h,a);return k+f+Ja})},createAnchorTag:function(a,c,b){a=this.createAnchorAttrsStr(a,c);b=this.processAnchorText(b);return"<a "+a+">"+b+"</a>"},createAnchorAttrsStr:function(a,c){var b=['href="'+c+'"'],d=this.createCssClass(a);d&&b.push('class="'+d+'"');this.newWindow&&
b.push('target="_blank"');return b.join(" ")},createCssClass:function(a){var c=this.className;return c?c+" "+c+"-"+a:""},processAnchorText:function(a){this.stripPrefix&&(a=this.stripUrlPrefix(a));a=this.removeTrailingSlash(a);return this.doTruncate(a)},stripUrlPrefix:function(a){return a.replace(this.urlPrefixRegex,"")},removeTrailingSlash:function(a){"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1));return a},doTruncate:function(a){var c=this.truncate;c&&a.length>c&&(a=a.substring(0,c-2)+"..");return a}};
a.link=function(c,b){return(new a(b)).link(c)};return a}),ea=function(){var a,c,b={};c=window.navigator.userAgent.toLowerCase();b.ios=function(){return b.iphone()||b.ipod()||b.ipad()};b.iphone=function(){return a("iphone")};b.ipod=function(){return a("ipod")};b.ipad=function(){return a("ipad")};b.android=function(){return a("android")};b.androidPhone=function(){return b.android()&&a("mobile")};b.androidTablet=function(){return b.android()&&!a("mobile")};b.blackberry=function(){return a("blackberry")||
a("bb10")||a("rim")};b.blackberryPhone=function(){return b.blackberry()&&!a("tablet")};b.blackberryTablet=function(){return b.blackberry()&&a("tablet")};b.windows=function(){return a("windows")};b.windowsPhone=function(){return b.windows()&&a("phone")};b.windowsTablet=function(){return b.windows()&&a("touch")};b.fxos=function(){return(a("(mobile;")||a("(tablet;"))&&a("; rv:")};b.fxosPhone=function(){return b.fxos()&&a("mobile")};b.fxosTablet=function(){return b.fxos()&&a("tablet")};b.meego=function(){return a("meego")};
b.mobile=function(){return b.androidPhone()||b.iphone()||b.ipod()||b.windowsPhone()||b.blackberryPhone()||b.fxosPhone()||b.meego()};b.tablet=function(){return b.ipad()||b.androidTablet()||b.blackberryTablet()||b.windowsTablet()||b.fxosTablet()};b.portrait=function(){return 90!==Math.abs(window.orientation)};b.landscape=function(){return 90===Math.abs(window.orientation)};b.detect=function(){if(b.ios()){if(b.ipad())return"tablet";if(b.iphone()||b.ipod())return"mobile"}else return b.android()?b.androidTablet()?
"tablet":"mobile":b.blackberry()?b.blackberryTablet()?"tablet":"mobile":b.windows()?b.windowsTablet()?"tablet":b.windowsPhone()?"mobile":"desktop":b.fxos()?b.fxosTablet()?"tablet":"mobile":b.meego()?"mobile":"desktop"};a=function(a){return-1!==c.indexOf(a)};return b}(),t=function(a){var c={},b=a.document,d;c.disabled=!1;c.set=function(a,c){};c.get=function(a){};c.remove=function(a){};c.clear=function(){};c.transact=function(a,b,d){var P=c.get(a);null==d&&(d=b,b=null);"undefined"==typeof P&&(P=b||
{});d(P);c.set(a,P)};c.getAll=function(){};c.forEach=function(){};c.serialize=function(a){return L.stringify(a)};c.deserialize=function(a){if("string"==typeof a)try{return L.parse(a)}catch(c){return a||void 0}};var e;try{e="localStorage"in a&&a.localStorage}catch(f){e=!1}if(e)d=a.localStorage,c.set=function(a,b){return void 0===b?c.remove(a):(d.setItem(a,c.serialize(b)),b)},c.get=function(a){return c.deserialize(d.getItem(a))},c.remove=function(a){d.removeItem(a)},c.clear=function(){d.clear()},c.getAll=
function(){var a={};return c.forEach(function(c,b){a[c]=b}),a},c.forEach=function(a){for(var b=0;b<d.length;b++){var P=d.key(b);a(P,c.get(P))}};else if(b.documentElement.addBehavior){var g,h;try{h=new ActiveXObject("htmlfile"),h.open(),h.write('<script>document.w=window\x3c/script><iframe src="/favicon.ico"></iframe>'),h.close(),g=h.w.frames[0].document,d=g.createElement("div")}catch(l){d=b.createElement("div"),g=b.body}a=function(a){return function(){var b=Array.prototype.slice.call(arguments,0);
b.unshift(d);g.appendChild(d);d.addBehavior("#default#userData");d.load("localStorage");b=a.apply(c,b);return g.removeChild(d),b}};var k=RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),n=function(a){return a.replace(/^d/,"___$&").replace(k,"___")};c.set=a(function(a,b,P){return b=n(b),void 0===P?c.remove(b):(a.setAttribute(b,c.serialize(P)),a.save("localStorage"),P)});c.get=a(function(a,b){return b=n(b),c.deserialize(a.getAttribute(b))});c.remove=a(function(a,c){c=n(c);a.removeAttribute(c);a.save("localStorage")});
c.clear=a(function(a){var c=a.XMLDocument.documentElement.attributes;a.load("localStorage");for(var b=0,q;q=c[b];b++)a.removeAttribute(q.name);a.save("localStorage")});c.getAll=function(a){var b={};return c.forEach(function(a,c){b[a]=c}),b};c.forEach=a(function(a,b){for(var P=a.XMLDocument.documentElement.attributes,d=0,e;e=P[d];++d)b(e.name,c.deserialize(a.getAttribute(e.name)))})}try{c.set("__storejs__","__storejs__"),"__storejs__"!=c.get("__storejs__")&&(c.disabled=!0),c.remove("__storejs__")}catch(p){c.disabled=
!0}c.enabled=!c.disabled;return c}(Function("return this")()),v={set:function(a,c,b){t.set(a,{val:c,exp:b,time:(new Date).getTime()})},get:function(a){a=t.get(a);return!a||(new Date).getTime()-a.time>a.exp?null:a.val}};(function(a,c){return c?{get:function(b){return a[b]&&c.parse(a[b])},set:function(b,d){a[b]=c.stringify(d)}}:{}})(this.localStorage||{},L);var T=function(a){for(a=3;a--;)try{return new (this.XMLHttpRequest||ActiveXObject)(["Msxml2","Msxml3","Microsoft"][a]+".XMLHTTP")}catch(c){}},f=
function(){var a=function(){return a.get.apply(a,arguments)},c=a.utils={isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isPlainObject:function(a){return!!a&&"[object Object]"===Object.prototype.toString.call(a)},toArray:function(a){return Array.prototype.slice.call(a)},getKeys:Object.keys||function(a){var c=[],b="";for(b in a)a.hasOwnProperty(b)&&c.push(b);return c},escape:function(a){return String(a).replace(/[,;"\\=\s%]/g,function(a){return encodeURIComponent(a)})},
retrieve:function(a,c){return null==a?c:a}};a.defaults={};a.expiresMultiplier=86400;a.set=function(a,b,d){if(c.isPlainObject(a))for(var e in a)a.hasOwnProperty(e)&&this.set(e,a[e],b);else{d=c.isPlainObject(d)?d:{expires:d};e=void 0!==d.expires?d.expires:this.defaults.expires||"";var f=typeof e;"string"===f&&""!==e?e=new Date(e):"number"===f&&(e=new Date(+new Date+1E3*this.expiresMultiplier*e));""!==e&&"toGMTString"in e&&(e=";expires="+e.toGMTString());var f=(f=d.path||this.defaults.path)?";path="+
f:"",g=d.domain||this.defaults.domain,g=g?";domain="+g:"";d=d.secure||this.defaults.secure?";secure":"";document.cookie=c.escape(a)+"="+c.escape(b)+e+f+g+d}return this};a.remove=function(a){a=c.isArray(a)?a:c.toArray(arguments);for(var b=0,d=a.length;b<d;b++)this.set(a[b],"",-1);return this};a.empty=function(){return this.remove(c.getKeys(this.all()))};a.get=function(a,b){b=b||void 0;var d=this.all();if(c.isArray(a)){for(var e={},f=0,g=a.length;f<g;f++){var h=a[f];e[h]=c.retrieve(d[h],b)}return e}return c.retrieve(d[a],
b)};a.all=function(){if(""===document.cookie)return{};for(var a=document.cookie.split("; "),c={},b=0,q=a.length;b<q;b++){var d=a[b].split("=");c[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return c};a.enabled=function(){if(navigator.cookieEnabled)return!0;var c="_"===a.set("_","_").get("_");a.remove("_");return c};return a}(),k=window,U=document,d=null,n=null,c={},b={},y={},ma=[];c.session={};var E=k.document.title,h={base_ready:{begin:0,max:30},all_ready:{begin:0,max:60},io:{begin:0,max:30}},
w={},s={},F=0;b.waiting_time=15;var z=function(a,c){y&&y.connected?y.emit(a,c):ma.push({channel:a,data:c})},N=function(){if(0<ma.length){var a=d.clone(ma);ma=[];d.each(a,function(a){y.emit(a.channel,a.data)})}},K="none",V=function(){var a=c.session,b=a.agents_rated||{},d=a.agent||a.last_agent||"";d&&!b[d]&&(b[d]="good",a.agents_rated=b,e.find(".rate-good").addClass("rated"),z("cev",{ev:"rate",value:"good",time:D()}))},W=function(){var a=c.session,b=a.agents_rated||{},d=a.agent||a.last_agent||"";d&&
!b[d]&&(b[d]="bad",a.agents_rated=b,e.find(".rate-bad").addClass("rated"),z("cev",{ev:"rate",value:"bad",time:D()}))},r=function(){var a=c.visitor,d=a.name||"",e=a.email||"",a=a.phone||"",g=l.find("#v_department_offline").val(),h=l.find("#v_message_offline").val(),Ua=!0,p=c.widget.offline_survey||{};"active"!=p.department.status||1!=p.department.is_require||g?(l.find("#v_department_offline").removeClass("form-error"),l.find("#error_department_offline").hide()):(Ua=!1,l.find("#v_department_offline").addClass("form-error"),
l.find("#error_department_offline").show());h?l.find("#v_message_offline").removeClass("form-error"):(Ua=!1,l.find("#v_message_offline").addClass("form-error"));Ua?(d={ev:"message_offline",name:d,email:e,phone:a,department:g,message:h,url:k.location.href,time:D()},"offline"==b._status_account?(e=b.url_sock_p+"ev/message_offline",d.aid=b.aid,d.vid=f.get("__sbzid")||"",d.sid=f.get("__sbzsid")||"",Ka(e,n.param(d),function(a){})):z("cev",d),ra("hide"),sa("show"),l.find("#v_message_offline").val("")):
I("offline")},Da=function(){var a=c.widget.offline_survey||{},d=l.find("#v_name_offline").val(),e=l.find("#v_email_offline").val(),g=l.find("#v_phone_offline").val(),h=l.find("#v_department_offline_edit").val(),p=l.find("#v_message_offline_edit").val(),m=!0;"active"!=a.name.status||1!=a.name.is_require||d?(l.find("#v_name_offline").removeClass("form-error"),l.find("#error_name_offline").hide()):(m=!1,l.find("#v_name_offline").addClass("form-error"),l.find("#error_name_offline").show());"active"!=
a.email.status||1!=a.email.is_require&&!e||wa(e)?(l.find("#v_email_offline").removeClass("form-error"),l.find("#error_email_offline").hide()):(m=!1,l.find("#v_email_offline").addClass("form-error"),l.find("#error_email_offline").show());"active"!=a.phone.status||1!=a.phone.is_require||g?(l.find("#v_phone_offline").removeClass("form-error"),l.find("#error_phone_offline").hide()):(m=!1,l.find("#v_phone_offline").addClass("form-error"),l.find("#error_phone_offline").show());"active"!=a.department.status||
1!=a.department.is_require||h?(l.find("#v_department_offline_edit").removeClass("form-error"),l.find("#error_department_edit_offline").hide()):(m=!1,l.find("#v_department_offline_edit").addClass("form-error"),l.find("#error_department_edit_offline").show());p?l.find("#v_message_offline_edit").removeClass("form-error"):(m=!1,l.find("#v_message_offline_edit").addClass("form-error"));m?(a={ev:"message_offline",name:d,email:e,phone:g,department:h,message:p,url:k.location.href,time:D()},"offline"==b._status_account?
(h=b.url_sock_p+"ev/message_offline",a.aid=b.aid,a.vid=f.get("__sbzid")||"",a.sid=f.get("__sbzsid")||"",Ka(h,n.param(a),function(a){})):z("cev",a),G("name",d),G("email",e),G("phone",g),xa("hide"),sa("show"),l.find("#v_message_offline_edit").val("")):I("offline")},O=function(){var a=c.widget.survey,b=e.find("#v_department_survey").val(),d=e.find("#v_name_survey").val(),f=e.find("#v_email_survey").val(),g=e.find("#v_phone_survey").val(),h=e.find("#v_question_survey").val(),l=!0;"active"!=a.department.status||
1!=a.department.is_require||b?(e.find("#v_department_survey").removeClass("form-error"),e.find("#error_department_survey").hide()):(l=!1,e.find("#v_department_survey").addClass("form-error"),e.find("#error_department_survey").show());"active"!=a.name.status||1!=a.name.is_require||d?(e.find("#v_name_survey").removeClass("form-error"),e.find("#error_name_survey").hide()):(l=!1,e.find("#v_name_survey").addClass("form-error"),e.find("#error_name_survey").show());"active"!=a.email.status||1!=a.email.is_require&&
!f||wa(f)?(e.find("#v_email_survey").removeClass("form-error"),e.find("#error_email_survey").hide()):(l=!1,e.find("#v_email_survey").addClass("form-error"),e.find("#error_email_survey").show());"active"!=a.phone.status||1!=a.phone.is_require||g?(e.find("#v_phone_survey").removeClass("form-error"),e.find("#error_phone_survey").hide()):(l=!1,e.find("#v_phone_survey").addClass("form-error"),e.find("#error_phone_survey").show());"active"==a.question.status&&1==a.question.is_require&&h&&e.find(".type_message textarea").val(h);
l?(a={ev:"survey",department:b||"",name:d||"",email:f||"",phone:g||"",time:D()},z("cev",a),a.department&&(c.session.department=b),a.phone&&G("phone",g),a.name&&G("name",d),a.email&&G("email",f),aa("hide"),ba("show")):I("online")},na=function(){var a=e.find("#v_name_contact").val(),c=e.find("#v_email_contact").val(),b=!0;a?e.find("#v_name_contact").removeClass("form-error"):(b=!1,e.find("#v_name_contact").addClass("form-error"));wa(c)?e.find("#v_email_contact").removeClass("form-error"):(b=!1,e.find("#v_email_contact").addClass("form-error"));
b&&(b={ev:"edit_contact",name:a,email:c,time:D()},z("cev",b),G("name",a),G("email",c),ya("hide"),za("show"))},S=function(){p("save email transcript");var a=e.find("#v_email_transcript").val();if(wa(a)){e.find("#v_email_transcript").removeClass("form-error");var c={ev:"email_transcript",email:a,time:D()};z("cev",c);G("email",a);X("hide")}else e.find("#v_email_transcript").addClass("form-error")},$=function(a){p("Typing...");var q=c.session;13===a.which?(a.preventDefault(),a=e.find(".type_message textarea").val(),
p(a),a&&"offline"!=b.status_account&&(oa("",d.escape(a)),Aa("hide"),z("cev",{ev:"chat",message:a,url:k.location.href,time:D()}),e.find(".type_message textarea").val(""),q.is_typing=!1,q.agent&&Ia("SUBIZ Chat","Visitor chat",q.agent),d.isEmpty(c.triggers)||M("chat_message"),q.agent||pa(b.waiting_time),v.set("sbz_time_last_message",D(),3E5))):q.is_typing||(q.is_typing=!0,q={ev:"chatstates",state:"composing",time:D()},z("cev",q))},pa=function(a){w.agent_busy&&(clearTimeout(w.agent_busy),w.agent_busy=
null);v.get("sbz_notify_agent_busy")||(w.agent_busy=setTimeout(function(){!c.session.agent&&c.lang.other.agent_busy&&(fa(c.lang.other.agent_busy),v.set("sbz_notify_agent_busy","1",3E5))},1E3*a))},g=function(){var a=e.find(".notice_new_message").html(),a=parseInt(a,10);return 0<a?a:0},R=function(){if(b.is_expand)"online"==b.status_widget?Qa():J();else{var a=c.session;a.is_expand&&1==a.is_expand&&(b.is_expand=1,"online"==b.status_widget?e.find(".button_chat_online").click():l.find(".button_chat_offline").click())}if(a=
v.get("sbz_triggers_state"))t.remove("sbz_triggers_state"),p("sbz_triggers_state"),p(a),d.isObject(a)&&(p(a),s=a);if(a=v.get("sbz_new_message"))t.remove("sbz_new_message"),Va(a),I("online");a=v.get("sbz_sound");if("on"==a||"off"==a)t.remove("sbz_sound"),c.session.sound=a,Wa(a);var a=v.get("sbz_time_last_message"),a=parseInt(a,10),q=v.get("sbz_notify_agent_busy");0<a&&!q&&(a=D()-a,q=b.waiting_time-a,!c.session.agent&&-45<q&&(a>b.waiting_time?pa(0):0<a&&pa(q)))},A=function(){if(c.session.slot){z("cev",
{ev:"presence_status"});var a=D(),b=new Date(c.visitor_session.time.start),a=a-Math.floor((b.getTime()+6E4*b.getTimezoneOffset())/1E3);time=18E5<a?6E5:9E5<a?18E4:6E4;108E5>a&&setTimeout(A,time)}},M=function(a){var b=c.session,d=c.visitor_session,e=c.visitor;n.each(c.triggers,function(c,f){p("trigger data");p(f);p("trigger_id : "+f.id);var g=Fa(f.data.condition);p("trigger_type : "+g);"undefined"==typeof s[f.id]&&(s[f.id]="-1");var h=s[f.id];p("trigger_result : "+h);if(f.data.event==a){if("once"==
g){if(("1"==h||"0"==h)&&f.fire_once)return!0}else if("limit"==g){if("1"==h&&f.fire_once)return!0}else if("unlimited"==g&&"1"==h&&f.fire_once)return!0;p("Checking conditions...");var l=f.data.condition[0],m=f.data.condition.slice(1),r=null;p("condition",m);n.each(m,function(a,c){p("trigger condition");p(m[a]);if("and"==l&&!1===r||"or"==l&&!0===r)return!1;var f="",g=m[a][2];if("@hour_of_day"==m[a][1])f=(new Date).getHours(),g=parseInt(g,10);else if("@day_of_week"==m[a][1])f=(new Date).getDay(),g=parseInt(g,
10);else if("@visitor_time_on_site"==m[a][1]){var f=0,h=v.get("sbz_time_start"),h=parseInt(h,10);h||(h=new Date(d.time.start))&&(h=Math.floor(h.getTime()/1E3));h&&(f=D()-h,f=parseInt(Math.round(f),10));g=parseInt(g,10)}else"@visitor_ip"==m[a][1]?f=d.ip:"@visitor_city"==m[a][1]?(f=b.geo.city,f=f.toLowerCase(),g=g.toLowerCase()):"@visitor_country_code"==m[a][1]?(f=b.geo.country,f=f.toLowerCase(),g=g.toLowerCase()):"@visitor_country_name"==m[a][1]?(f=b.geo.country_name,f=f.toLowerCase(),g=g.toLowerCase()):
"@visitor_page_url"==m[a][1]?(f=k.location.href,f=f.replace(/^(http:\/\/|https:\/\/)/gi,""),g=g.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_page_title"==m[a][1]?f=document.title:"@visitor_page_count"==m[a][1]?(f=d.page_visited.length,g=parseInt(g,10)):"@referrer"==m[a][1]?(f=document.referrer,f=f.replace(/^(http:\/\/|https:\/\/)/gi,""),g=g.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_name"==m[a][1]?f=e.name||"":"@visitor_email"==m[a][1]?f=e.email||"":"@visitor_phone"==m[a][1]?f=e.phone||
"":"@visitor_referrer"==m[a][1]?(f=d.v.referrer,f=f.replace(/^(http:\/\/|https:\/\/)/gi,""),g=g.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_search_engine"==m[a][1]?f=d.se&&d.se.name?d.se.name:"":"@visitor_search_terms"==m[a][1]?f=d.se&&d.se.kw?d.se.kw:"":"@visitor_type"==m[a][1]?(f=d.v.type,g=g.toLowerCase()):"@visitor_device"==m[a][1]?(f=ea.detect()||"desktop",g=g.toLowerCase()):"@visitor_label"==m[a][1]&&(f=e.labels||[]);r=ta(f,m[a][0],g);p(f+" "+m[a][0]+" "+g+" = "+r)});!0===r?(s[f.id]=
"1",Ea(f),z("cev",{ev:"trigger_result",id_trigger:f.id,status:"success",time:D()}),"undefined"!=typeof w[f.id]&&null!==w[f.id]&&clearTimeout(w[f.id])):!1===r&&(s[f.id]="0","undefined"!=typeof w[f.id]&&null!==w[f.id]&&clearTimeout(w[f.id]),w[f.id]=setTimeout(function(){p("run triggers again : "+a);M(a)},5E3))}})},ta=function(a,c,b){return"eq"==c?d.isArray(a)?d.contains(a,b)?!0:!1:a===b?!0:!1:"neq"==c?a!==b?!0:!1:"lt"==c?a<b?!0:!1:"gt"==c?a>b?!0:!1:"lte"==c?a<=b?!0:!1:"gte"==c?a>=b?!0:!1:"icontains"==
c?(a=(a+"").indexOf(b,0),-1===a?!1:!0):"nicontains"==c?(c=new RegExp(b,"g"),a=c.test(a),!1===a?!0:!1):"iregex"==c?(c=new RegExp(b,"gi"),(a=c.test(a))?!0:!1):"true"==c?!0===a?!0:!1:"false"==c?!1===a?!0:!1:!1},Ea=function(a){n.each(a.data.actions,function(f,g){p("run trigger action");p(g);if("autoInvite"==g[0]||"sendMessageToVisitor"==g[0]){if("offline"==b.status_account||"offline"==b.status_widget)return!1;if("autoInvite"==g[0]){var h=e.find(".line_message").length,l=c.session;if(!l.slot||0<h||l.agent)return!1}else{var m=
0;0==e.find(".supporter_chat, visitor_chat").length&&(m=1)}if(!d.isString(g[1][0])||!d.isString(g[1][1]))return!1;h={name:g[1][0],avatar:g[1][1]};l=g[2];z("cev",{ev:"trigger_message",from:h,message:l,id_trigger:a.id,url:k.location.href,time:D()});oa(h,l);Aa("hide");e.find(".avatar_supporter img").attr("src",Q(h.avatar));e.find(".name_supporter").html(d.escape(h.name));"offline"==b.status_widget&&(b.status_widget="online",Y("hide"),Z("show"));"survey"==b.widget_window?(aa("hide"),ba("show")):"online_compress"==
b.widget_window&&("autoInvite"==g[0]?e.find(".button_chat_online").click():m?e.find(".button_chat_online").click():(eb(),I("online")));fb();gb()}else"applyToLabel"==g[0]?(z("cev",{ev:"add_label",labels:g[1],id_trigger:a.id,url:k.location.href,time:D()}),d.each(g[1],function(a){Ia("Subiz Labels","TriggerAddLabel",a)})):"removeToLabel"==g[0]&&(z("cev",{ev:"remove_label",labels:g[1],id_trigger:a.id,url:k.location.href,time:D()}),d.each(g[1],function(a){Ia("Subiz Labels","TriggerRemovedLabel",a)}))})},
Fa=function(a){if(void 0!==a&&null!==a&&0<a.length)var c=a[0];else return!1;a=a.slice(1);var b="@visitor_ip @visitor_city @visitor_country_code @visitor_country_name @visitor_name @visitor_referrer @visitor_search_engine @visitor_search_terms @visitor_type".split(" "),d=["@hour_of_day","@day_of_week","@visitor_time_on_site","@visitor_page_count"],e=["@visitor_page_url","@visitor_page_title","@referrer"],f=0,g=0,h=0;for(x in a)-1<n.inArray(a[x][1],b)?f++:-1<n.inArray(a[x][1],d)?g++:-1<n.inArray(a[x][1],
e)&&h++;if("and"==c||"or"==c)return 0<h?"unlimited":0<g?"limit":"once"},C=function(){var a={widget:b.status_widget,account:b.status_account,department:"",agent:""},e=c.session;e.department&&d.each(c.departments,function(c){c.name==e.department&&(a.department=c.status)});e.agent&&d.each(c.agents,function(c){c.username==e.agent&&(a.agent="offline"==c.state?"offline":"online")});return a},ua=function(){var a=c.session.department||"";if("online"==b.status_widget)var f=e.find("#department select").val();
else f=l.find("#department select").val(),d.isEmpty(f)&&(f=l.find("#department_edit select").val());d.isEmpty(f)||(a=f);var g='<option value="">'+c.lang.online.department_help+"</option>";d.each(c.departments,function(a){"online"==a.status&&(g+='<option value="'+d.escape(a.name)+'">'+d.escape(a.name)+"</option>")});e.find("#department select").html(g);g='<option value="">'+c.lang.online.department_help+"</option>";d.each(c.departments,function(a){g+='<option value="'+d.escape(a.name)+'">'+d.escape(a.name)+
"</option>"});l.find("#department select").html(g);l.find("#department_edit select").html(g);d.isEmpty(a)||(a=d.escape(a),e.find('#department select option[value="'+a+'"]').attr("selected","selected"),l.find('#department select option[value="'+a+'"]').attr("selected","selected"),l.find('#department_edit select option[value="'+a+'"]').attr("selected","selected"))},G=function(a,b){if("undefined"==typeof b||!b)return!1;var f=c.visitor,g=d.escape(b);"name"==a?(f.name=b,e.find(".v_name").val(b),l.find(".v_name").val(b),
e.find(".v_name_text").html(g),l.find(".v_name_text").html(g),e.find(".visitor_name").html(g)):"email"==a?(f.email=b,e.find(".v_email").val(b),l.find(".v_email").val(b),e.find(".v_email_text").html(g),l.find(".v_email_text").html(g)):"phone"==a&&(f.phone=b,e.find(".v_phone").val(b),l.find(".v_phone").val(b))},Ga=function(){l.find(".notification_widget").remove();e.find(".notification_widget").remove();if("online"==b.status_account){Y("hide");Z("show");ga("hide");ca("hide");ha("show");var a=C(),d=
!1;"offline"==a.agent&&"offline"==a.department&&(d=!0);"active"==c.widget.survey.status&&d&&1>c.history.length?(ba("hide"),aa("show")):(aa("hide"),ba("show"))}else Z("hide"),Y("show"),ia("hide"),ja("show"),sa("hide"),La("show");ka("enable");b.status_widget=b.status_account},va=function(){c.session.department?Ga():ka("enable")},Qa=function(){ga("hide");ca("hide");ha("show");var a=!1;if("active"==c.widget.survey.status){var a=!0,b=e.find(".line_message").length;if(c.session.agent||0<b)a=!1}a?(ba("hide"),
aa("show")):(aa("hide"),ba("show"));Va(0)},J=function(){ia("hide");ja("show");sa("hide");La("show")},u=function(){p("io ready");var a=f.get("__sbzid","");if("offline"==b._status_account){var g=f.get("__sbzsid")||"",g=["aid="+b.aid,"vid="+a,"sid="+g,"url="+encodeURIComponent(k.location.href),"title="+encodeURIComponent(U.title),"referer="+encodeURIComponent(U.referrer)];Ka(b.url_sock_p+"ev/init",g.join("&"),function(a){a=L.parse(a);d.each(a,function(a){Ra(a)})})}else y=io.connect(b.url_socket,{"max reconnection attempts":18,
"sync disconnect on unload":!1,"connect timeout":5E3,"reconnection limit":4E3}),y.on("sev",Ra),y.on("connect",function(){p("socket connected");b.socket_connected=y.connected;b.socket_connecting=y.connecting;c.all_ready||y.emit("cev",{ev:"init",aid:b.aid,vid:a,url:k.location.href,title:U.title,referer:U.referrer})}),y.on("reconnect_failed",function(a){p("socket reconnect failed")}),y.on("reconnect",function(a){p("socket reconnected");ka("enable");N();b.click_reconnect&&(delete b.click_reconnect,e.find(".notification_reconnecting").remove(),
l.find(".notification_reconnecting").remove(),va())}),y.on("reconnecting",function(a,d){p("socket reconnecting");b.socket_connected=y.connected;b.socket_connecting=y.connecting;var e=Math.floor((new Date).getTime()/1E3);p("attempting reconnect - "+d+" - "+(e-F)+" s");60<e-F&&(p("reconnect timeout - show notification"),c.session&&c.session.agent&&Ha(),ka("disable"),fa('Lost connection! <a href="javascript:;" class="link_reconnect">Click here</a> to try reconnect.'))}),y.on("error",function(a){p("socket error")}),
y.on("disconnect",function(){p("socket disconnect");b.socket_connected=y.connected;b.socket_connecting=y.connecting;F=Math.floor((new Date).getTime()/1E3)})},Ra=function(a){p(a);if("set_id"==a.ev){var q=f.get("__sbzid","");a.vid&&a.vid!=q&&(p("visitor is new : set cookie __sbzid"),f.set("__sbzid",a.vid,{expires:365,path:"/"}));f.set("__sbzsid",a.sid,{path:"/"})}else if("init:full"==a.ev)c.session=a.session||{},c.triggers=a.account.triggers||[],c.agents=a.account.agents||[],c.departments=a.account.departments||
[],c.history=a.history||[],c.visitor=a.session.visitor||{},c.visitor_session=a.session.visitor_session||{},q=f.get("__sbzid",""),a.session.vid&&a.session.vid!=q&&(p("visitor is new : set cookie __sbzid"),f.set("__sbzid",a.session.vid,{expires:365,path:"/"})),db(wb);else if("chat"==a.ev){var h=c.session,q=a.from.split("@")[0],k=qa(q);if(k){var m=0;h.agent||(m=1,h.agent=q,Xa("show"),Ma("show"),Na("show"),Ya("show"),q=c.lang.other.agent_join_chat,q=q.replace("{agent}",k.name),fa(q),b.status_account=
"online",e.find(".type_message textarea").prop("disabled")&&ka("enable"),w.agent_busy&&(clearTimeout(w.agent_busy),w.agent_busy=null));e.find(".avatar_supporter img").attr("src",Q(k.avatar));e.find(".name_supporter").html(d.escape(k.name));e.find(".text_supporter").html(d.escape(k.job_title));oa(k,d.escape(a.message));Aa("hide");"offline"==b.status_widget&&(b.status_widget=b.status_account,Y("hide"),Z("show"),ga("hide"),ha("show"),ca("hide"),aa("hide"),ba("show"));"survey"==b.widget_window?(aa("hide"),
ba("show")):"online_compress"==b.widget_window&&(eb(),I("online"),m&&e.find(".button_chat_online").click());fb();gb();Ia("SUBIZ Chat","Agent chat",h.agent)}}else if("change_state"==a.ev){var h=c.session,r="",s="offline";if(r=qa(a.agent)){d.each(c.agents,function(b){b.username==a.agent&&(b.state=a.state,r=b);"online"==b.state&&("active"==c.widget.survey.status&&"active"==c.widget.survey.department?0<b.departments.length&&(s="online"):s="online");"away"==b.state&&b.username==h.agent&&(s="online")});
d.isEmpty(c.departments)||(d.each(c.departments,function(a,b){a.status="offline";d.each(c.agents,function(c){"online"==c.state&&0<c.departments.length&&d.contains(c.departments,a.name)&&(a.status="online")})}),ua());b.status_account=s;k=C();m=b.widget_window;"offline"==k.widget&&(!h.department&&"online"==k.account||h.department&&"online"==k.department)&&("offline_compress"==m?(Y("hide"),Z("show"),ha("hide"),ga("show")):(q=c.lang.other.agent_online,q=q.replace("{agent}",r.name),Za(q,"account_online")));
if("online"==k.widget&&"offline"==k.account)if("online_compress"==m){if(0<g())return;Z("hide");Y("show");ja("hide");ia("show")}else ka("disable"),Za(c.lang.other.agent_offline,"account_offline");b.status_widget=s;h.agent&&"offline"==a.state&&(Ha(),ka("disable"))}else p("change_state - agent not in list")}else if("agent_connection"==a.ev){if(h=c.session,h.agent&&h.agent==a.agent&&(r=qa(a.agent)))"disconnect"==a.state?(q=c.lang.other.agent_disconnect,q=q.replace("{agent}",r.name),fa(q)):"connect"==
a.state&&(q=c.lang.other.agent_reconnect,q=q.replace("{agent}",r.name),fa(q))}else if("chatstates"==a.ev)h=c.session,q=a.from.split("@")[0],h.agent&&h.agent==q&&("composing"==a.state?Oa("show",q):"paused"==a.state&&Oa("hide"));else if("sync"==a.ev)a.name&&G("name",a.name),a.email&&G("email",a.email),a.phone&&G("phone",a.phone),a.message&&(oa("",a.message),Aa("hide"),Y("hide"),Z("show"),e.find(".button_chat_online").click()),"undefined"!=typeof a.is_expand&&(q=1==a.is_expand?"hide":"show",k=1==a.is_expand?
"show":"hide",b.is_expand=parseInt(a.is_expand,10),"online"==b.status_widget?(ga(q),ha(k)):(ia(q),ja(k)));else if("block"==a.ev)n(".sbzon").remove(),n(".sbzoff").remove(),y&&y.connected&&y.disconnect(),f.set("__sbzbl","1",{path:"/",expires:365});else if("transfer"==a.ev){if(h=c.session,k=qa(h.agent))q=c.lang.other.agent_left_chat,q=q.replace("{agent}",k.name),Ha({message:q}),h.last_agent=h.agent,delete h.agent,delete h.department,va(),Oa("hide")}else if("end_chat"==a.ev){if(h=c.session,k=qa(h.agent))h.last_agent=
h.agent,delete h.agent,q=c.lang.other.agent_end_chat,q=q.replace("{agent}",k.name),fa(q),Oa("hide"),t.remove("sbz_time_last_message"),t.remove("sbz_notify_agent_busy")}else"full_slot"==a.ev&&(k=c.session.visitor,q="",(m=e.find(".visitor_content_chat").last())&&(q=m.text()),q&&(k.name||k.email?l.find("#v_message_offline").val(q):l.find("#v_message_offline_edit").val(q)),Z("hide"),Y("show"),ia("hide"),ja("show"),La("show"))},Sa=function(a){var b=new Date;if(0<h.base_ready.begin){if(seconds=(b.getTime()-
h.base_ready.begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>h.base_ready.max)return p("base_ready timeout : base_ready"),clearTimeout(h.base_ready.id),!0}else h.base_ready.begin=b.getTime();c.css_ready&&c.js_ready&&c.html_ready?(p("base ready : callback"),a()):h.base_ready.id=setTimeout(function(){p("base not ready : check again");Sa(a)},200)},Ta=function(a,b){h[a]||(h[a]={begin:0,max:5});var d=new Date;if(0<h[a].begin){if(seconds=(d.getTime()-h[a].begin)/1E3,seconds=parseInt(Math.round(seconds),
10),seconds>h[a].max)return p("wait base_ready timeout : "+a),clearTimeout(h[a].id),!0}else h[a].begin=d.getTime();c.base_ready?(p("base ready : callback"),b()):h[a].id=setTimeout(function(){p("base not ready : check again");Ta(a,b)},200)},cb=function(a,b){h[a]||(h[a]={begin:0,max:30});var d=new Date;if(0<h[a].begin){if(seconds=(d.getTime()-h[a].begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>h[a].max)return p("wait all_ready timeout : "+a),clearTimeout(h[a].id),!0}else h[a].begin=d.getTime();
c.all_ready?(p("all ready : callback"),b()):h[a].id=setTimeout(function(){p("all not ready : check again");cb(a,b)},500)},db=function(a){var b=new Date;if(0<h.all_ready.begin){if(seconds=(b.getTime()-h.all_ready.begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>h.all_ready.max)return p("all_ready timeout : all_ready"),clearTimeout(h.all_ready.id),y&&y.connected&&y.disconnect(),!0}else h.all_ready.begin=b.getTime();c.base_ready?(p("all ready : callback"),c.all_ready=!0,a()):h.all_ready.id=
setTimeout(function(){p("all not ready : check again");db(a)},200)},vb=function(){var a={config:b,lang:c.lang};c.html.online=d.template(c.html.online,a);c.html.offline=d.template(c.html.offline,a);var a=["online","offline"],g=a.length;d.each(a,function(a){var h="online"==a?"sbzon":"sbzoff",k=d.template(c.html.iframe,{name:h});(function(a,d,h){h=n(h);h.find("iframe").attr("src","javascript:false");h.appendTo("body");h=h.find("iframe")[0].contentWindow.document;h.write("<!DOCTYPE html><html><head></head><body></body></html>");
h.close();setTimeout(function(){var h={"margin-top":"0px","margin-right":"0px","margin-bottom":"0px",padding:"0px",border:"0px","background-color":"rgba(0, 0, 0, 0)",overflow:"hidden",position:"fixed","z-index":"16000001",bottom:"0px",display:"block",width:"310px",height:"431px"};h["left"==b.position?"left":"right"]="10px";n("."+d).css(h);h=n("#"+d+"_frame").contents();"online"==a?e=h:"offline"==a&&(l=h);h.find("head").append("<style>"+c.css+"</style>");h.find("body").append(n(c.html[a]));g--;0==
g&&(c.base_ready=!0);c.base_ready&&("online"==b.status_widget?(Y("hide"),Z("show"),ha("hide"),ga("show")):(Z("hide"),Y("show"),ja("hide"),ia("show")),c.widget.theme.url_twitter&&(e.find("#twitter a").attr("href",c.widget.theme.url_twitter),e.find("#twitter").show(),l.find("#twitter a").attr("href",c.widget.theme.url_twitter),l.find("#twitter").show()),c.widget.theme.url_facebook&&(e.find("#facebook a").attr("href",c.widget.theme.url_facebook),e.find("#facebook").show(),l.find("#facebook a").attr("href",
c.widget.theme.url_facebook),l.find("#facebook").show()),"active"==c.widget.theme.logo_status&&c.widget.theme.logo_image&&(e.find(".logo_company img").attr("src",Q(c.widget.theme.logo_image)),e.find(".logo_company").show()),"off"==f.get("__sbzbubble")&&(b.bubble="off",ca("hide")),"active"==c.widget.chat_bubble.status&&(e.find("#bubble_image img").attr("src",Q(c.widget.chat_bubble.image)),e.find("#bubble_image img").load(function(){p("bubble",b.bubble);b.bubble&&"off"==b.bubble||(ca("show"),I("online"));
b.is_expand&&ca("hide")}),e.find("#bubble_image").click(function(){e.find(".button_chat_online").click()}),e.find("#bubble_close").click(function(){ca("hide");b.bubble="off";f.set("__sbzbubble",b.bubble,{path:"/"})})),h=n("#subiz_status, .subiz_status"),0<h.length&&("online"==b.status_account?h.html(c.widget.chat_button.online_code):h.html(c.widget.chat_button.offline_code),n(U).on("click","#subiz_status, .subiz_status",function(){"online"==b.status_account?b.is_expand||Qa():b.is_expand||J()})),e.find(".button_chat_online").click(function(){b.is_expand||
z("cev",{ev:"sync",is_expand:1,time:D()});b.is_expand=1;c.all_ready?(p("click expand widget - all ready"),Qa(),b.chat_requested||(b.chat_requested=1,M("chat_requested"))):(p("click expand widget - all NOT ready"),e.find("#subiz_loading").is(":hidden")&&(p("click expand widget - show loading"),aa("hide"),ba("hide"),hb("show"),ga("hide"),ha("show")));"active"==c.widget.chat_bubble.status&&ca("hide")}),e.find(".online_heading").click(function(){b.is_expand=0;z("cev",{ev:"sync",is_expand:0,time:D()});
ha("hide");ga("show");"active"!=c.widget.chat_bubble.status||b.bubble&&"off"==b.bubble||(ca("show"),I("online"))}),l.find(".button_chat_offline").click(function(){b.is_expand||z("cev",{ev:"sync",is_expand:1,time:D()});b.is_expand=1;c.all_ready?(p("click expand widget offline - all ready"),J()):(p("click expand widget offline - all NOT ready"),l.find("#subiz_loading").is(":hidden")&&(p("click expand widget offline - show loading"),sa("hide"),La("hide"),ib("show"),ia("hide"),ja("show")))}),l.find(".offline_heading").click(function(){b.is_expand=
0;z("cev",{ev:"sync",is_expand:0,time:D()});ja("hide");ia("show")}))},50)})(a,h,k)})},wb=function(){p("Yes! Let's go!");var a=c.widget.survey,f=c.widget.offline_survey||{};d.isEmpty(c.departments)&&(a.department.status="inactive",f.department.status="inactive");"active"==a.status&&("active"==a.name.status?jb("show"):jb("hide"),"active"==a.email.status?kb("show"):kb("hide"),"active"==a.phone.status?lb("show"):lb("hide"),"active"==a.question.status?mb("show"):mb("hide"),"active"==a.department.status?
(p("fill data department"),ua(),nb("show")):nb("hide"));"active"==f.name.status?ob("show"):ob("hide");"active"==f.email.status?pb("show"):pb("hide");"active"==f.phone.status?qb("show"):qb("hide");"active"==f.department.status?(ua(),rb("show")):rb("hide");a=c.visitor;a.name&&G("name",a.name);a.email&&G("email",a.email);a.phone&&G("phone",a.phone);var h=c.session;h.agent?(d.each(c.agents,function(a){a.username==h.agent&&(e.find(".avatar_supporter img").attr("src",Q(a.avatar)),e.find(".name_supporter").html(d.escape(a.name)),
e.find(".text_supporter").html(d.escape(a.job_title)))}),d.each(h.agents_rated,function(a,b){"good"==a?e.find(".rate-good").addClass("rated"):"bad"==a&&e.find(".rate-bad").addClass("rated")}),Xa("show"),Ma("show"),Ya("show"),Na("show")):(Xa("hide"),Ma("hide"),Ya("hide"),Na("hide"));if(0<c.history.length){Aa("hide");var m="",t="";d.each(c.history,function(a){"agent"==a.from.type?d.each(c.agents,function(b){b.username==a.from.user&&(m=b,oa(b,d.escape(a.message)))}):"visitor"==a.from.type?oa("",d.escape(a.message)):
"trigger"==a.from.type?(t=a.from.user,oa(a.from.user,a.message)):"system"==a.from.type&&fa(a.message)});!m&&t&&(m=t);m&&(e.find(".avatar_supporter img").attr("src",Q(m.avatar)),e.find(".name_supporter").html(d.escape(m.name)))}hb("hide");ib("hide");p("restore session");R();d.isEmpty(c.triggers)||M("page_enter");A();e.find(".btn_start_chat").click(O);e.find(".btnoption").click(function(){X("toogle")});e.find(".option_config_sound label, .option_config_sound i").click(function(){e.find(".option_config_sound i").hasClass("icon_sound")?
(Wa("off"),c.session.sound="off"):(Wa("on"),c.session.sound="on")});e.find("#close_option").click(function(){X("hide")});e.find(".btn_endchat").click(function(){var a=qa(c.session.agent);if(a){var b=c.lang.online.ec_message,b=b.replace("{agent}",d.escape(a.name));e.find(".endchat_form .endchat_label").html(b);X("hide");Ba("show");Ha();z("cev",{ev:"end_chat",time:D()})}});e.find("#end_chat_footer").click(function(){e.find(".btn_endchat").click()});e.find("#ec_close").click(function(){Ba("hide")});
e.find("#edit_contact").click(function(){Ca("hide");var a=c.visitor;a.name||a.email?(za("show"),e.find("#v_name_contact_view").show(),a.name||e.find("#v_name_contact_view").hide(),e.find("#v_email_contact_view").show(),a.email||e.find("#v_email_contact_view").hide()):ya("show")});e.find("#edit_successful").click(na);e.find("#icon_edit_contact").click(function(){za("hide");ya("show")});e.find("#icon_close_contact").click(function(){X("hide")});e.find("#email_transcript").click(function(){Ca("hide");
$a("show")});e.find("#save_email_transcript").click(S);e.find("#cancel_email_transcript").click(function(){X("hide")});e.find("#cancel_contact").click(function(){X("hide")});e.on("click",".visitor_name",function(){X("show");Ca("hide");e.find("#edit_contact").click()});e.find("#rate_good").click(V);e.find("#rate_bad").click(W);e.find("#ec_rate_good").click(function(){e.find("#rate_good").click();Ba("hide")});e.find("#ec_rate_bad").click(function(){e.find("#rate_bad").click();Ba("hide")});e.find(".type_message textarea").on("keypress",
$);e.find(".type_message textarea").on("blur",function(){if(c.session.is_typing){c.session.is_typing=!1;var a={ev:"chatstates",state:"paused",time:D()};z("cev",a)}});e.on("click",".link_offline",function(){if("offline"==b.status_account){var a=e.find(".type_message textarea").val();l.find(".textarea_offline").val(a)}Ga()});l.find("#send_message_offline").click(r);l.find("#send_message_offline_edit").click(Da);l.find("#icon_edit_contact_offline").click(function(){ra("hide");xa("show")});l.find("#v_message_offline").change(function(){var a=
l.find("#v_message_offline").val();l.find("#v_message_offline_edit").val(a);l.find("#message_offline_text").html(d.escape(a))});l.find("#v_message_offline_edit").change(function(){var a=l.find("#v_message_offline_edit").val();l.find("#v_message_offline").val(a);l.find("#message_offline_text").html(d.escape(a))});l.find(".btn_send_another").click(function(){sa("hide");ra("show");l.find("#v_message_offline").val("");l.find("#v_message_offline_edit").val("")});e.on("click",".close_notification_widget",
function(){e.find(".chat_warning").has(this).remove()});l.on("click",".close_notification_widget",function(){l.find(".chat_warning").has(this).remove()});e.on("click",".link_reconnect",function(){b.socket_connected?va():(Za("Reconnecting...","reconnecting"),b.click_reconnect=1,F=Math.floor((new Date).getTime()/1E3),y&&!y.connected&&y.reconnect())});e.on("click",".link_refresh",function(){Ga()});l.on("click",".link_refresh",function(){Ga()});e.on("click",".link_chat_again",function(){va()});e.on("click",
"#ec_chat_again",function(){Ba("hide");va()});n(k).unload(function(){if(c.all_ready){v.set("sbz_triggers_state",s,9E5);var a=g();0<a&&v.set("sbz_new_message",a,9E5);c.session&&"off"==c.session.sound&&v.set("sbz_sound","off",9E5);b.bubble&&v.set("sbz_bubble",b.bubble,9E5)}});n(k).on("blur focus",function(a){K=a.type});b.idle_time=0;b.is_idle=0;var u=function(){b.idle_time+=1;5<=b.idle_time&&(p("visitor idle"),b.is_idle||(b.is_idle=1,z("cev",{ev:"change_activity",status:"idle"})),clearInterval(b.idle_interval),
delete b.idle_interval)};b.idle_interval=setInterval(u,6E4);var w=function(){b.idle_time=0;b.is_idle&&(p("visitor active"),b.is_idle=0,z("cev",{ev:"change_activity",status:"active"}),b.idle_interval||(b.idle_interval=setInterval(u,6E4)))};n(U).mousemove(function(a){w()});n(U).keypress(function(a){w()});e.find("html").mousemove(function(a){w()});e.find("html").keypress(function(a){w()})},qa=function(a){var b="";d.each(c.agents,function(c){c.username==a&&(b=c)});return b},Ha=function(a){var b=c.lang.other.visitor_end_chat;
"undefined"!=typeof a&&a.message&&(b=a.message);fa(b);ka("disable");Ma("hide");Na("hide");a=c.session;a.last_agent=a.agent;delete a.agent;t.remove("sbz_time_last_message");t.remove("sbz_notify_agent_busy")},Ia=function(a,b,c){"function"==typeof k.ga&&("undefined"!=typeof c?k.ga("send","event",a,b,c):k.ga("send","event",a,b))},eb=function(){var a=g();a++;Va(a)},fb=function(){var a=b.new_message_on_page||0,c=g();0<c?sb("("+c+") "+E):"blur"==K&&(a++,b.new_message_on_page=a,sb("("+a+") "+E))},gb=function(){var a=
c.session.sound||"on";"blur"==K&&"on"==a&&e.find("#audio_alert")[0].play()},Pa={core_version:"2.20140724",is_local:!1,is_debug:!1,init:function(){if("1"==f.get("__sbzbl"))return!1;f.get("__sbzer")&&(Pa.is_debug=!0);v.get("sbz_time_start")||v.set("sbz_time_start",D(),18E5);b.p="https:"==k.location.protocol?"https:":"http:";b.url_static=Q("http://static.subiz.com/");b.url_socket="https://sock-ha.subiz.com";b.url_sock_p=Q("http://sock-p.subiz.com/");b.url_dashboard=Q("http://static-dashboard.subiz.com/");
b.url_css=Q(b.url_dashboard+"widget/css/"+b.aid+"/subiz-widget-view.css");b.url_avatar=Q(b.url_dashboard+"img/avatar-chat.png");var a=f.get("__sbzid")||"",e=f.get("__sbzsid")||"",g=[];g.push("sbz_aid="+b.aid);g.push("sbz_vid="+a);g.push("sbz_sid="+e);b.url_base_data=b.url_sock_p+"a/"+b.aid+"?vid="+a;b.url_socket+="/?"+g.join("&");p("begin load static files");ab(b.url_static+"views/widget.txt",function(a){p("cb get template");try{c.html=L.parse(a),c.html_ready=!0}catch(b){p("Error parse json data"),
p(b),c.html={},c.html_ready=!1}});ab(b.url_css,function(a){p("css ready");c.css=a.replace(/..\/..\/img\//g,b.url_dashboard+"widget/img/");c.css_ready=!0});ab(b.url_base_data,function(a){p("cb get base data");try{a=L.parse(a);if(a.is_deny){p("deny request");f.set("__sbzbl","1",{path:"/"});h.base_ready&&h.base_ready.id&&clearTimeout(h.base_ready.id);return}if(!a.status){p("error : base data");return}}catch(d){p("error : decode base data");p(d);return}p("build base widget");c.lang=a.widget.language.data;
c.lang.online.title_compress||(c.lang.online.title_compress=c.lang.online.title,c.lang.offline.title_compress=c.lang.offline.title);var e=a.widget.survey,g=a.widget.offline_survey||{};e.name&&e.name.status||(g.name={status:"active",is_require:1},g.email={status:"active",is_require:1},g.phone={status:g.phone||e.phone,is_require:1},g.department={status:e.department,is_require:1},e.name={status:"active",is_require:1},e.email={status:"active",is_require:1},e.phone={status:e.phone,is_require:1},e.question=
{status:e.question,is_require:1},e.department={status:e.department,is_require:1},a.widget.offline_survey=g);c.widget=a.widget;b.status_widget=a.status;b.status_account=a.status;b._status_account=a._status;b.position=a.position||"right";Sa(function(){n("body").waitUntilExists(vb)})});H.js({io:b.url_static+"public/js/io/socket.io.min.js"},{j:b.url_static+"public/js/j.min.js"},{_:b.url_static+"public/js/underscore-1.5.1.min.js"},function(){p("all js loaded");c.js_ready=!0});H.ready("io",function(){Ta("io",
u)});H.ready("j",function(){p("jquery ready");n=jQuery.noConflict(!0)});H.ready("_",function(){p("_ ready");d=k._.noConflict()})},test:function(){Pa.init()}},xb={_setAccount:function(a){b.aid=a;Pa.init()},expandWidget:function(){var a="api_expand_widget:"+(new Date).getTime();Ta(a,function(){b.is_expand||("online"==b.status_widget?e.find(".button_chat_online").click():l.find(".button_chat_offline").click())})},setInfo:function(a){"undefined"==typeof a||1>a.length||(p("api set_info - waiting all ready"),
cb("api_set_info",function(){p("api set_info - all ready");var c=d.pick(a,["name","email","phone"]),e;for(e in c)d.isEmpty(c[e])&&delete c[e];if(!d.isEmpty(c))if(d.each(c,function(a,b){"email"==b?wa(a)&&G(b,a):G(b,a)}),"offline"==b._status_account){e=f.get("__sbzid")||"";var g=f.get("__sbzsid")||"",h=["aid="+b.aid,"vid="+e,"sid="+g];d.each(c,function(a,b){h.push(b+"="+encodeURIComponent(a))});Ka(b.url_sock_p+"ev/set_info",h.join("&"),function(a){})}else z("cev",d.extend(c,{ev:"set_info"}))}))}},Q=
function(a){if(!a)return"";var b="https:"==U.location.protocol?"https://":"http://";a=a.replace(/^https?\:\/\//gi,"");return b+a},tb=function(a,b,c,d){if(k.XDomainRequest){var e=new XDomainRequest;e.onload=function(){d(e.responseText)};e.onprogress=function(){};e.ontimeout=function(){};e.onerror=function(){};"POST"==b?(e.open("POST",a),e.send(c)):(e.open("GET",a),e.send())}else{if(-1!=navigator.userAgent.indexOf("MSIE")&&8>parseInt(navigator.userAgent.match(/MSIE ([\d.]+)/)[1],10))return console.log("IE < 8"),
!1;var f=T();f.onreadystatechange=function(){4==f.readyState&&200==f.status&&d(f.responseText)};"POST"==b?(f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.send(c)):(f.open("GET",a,!0),f.send())}},ab=function(a,b){tb(a,"GET",null,b)},Ka=function(a,b,c){tb(a,"POST",b,c)},D=function(a){var b=new Date("2012-01-01T00:00:00Z"),b=b.getTime()+6E4*b.getTimezoneOffset(),b=Math.floor(b/1E3),c=new Date,c=c.getTime()+6E4*c.getTimezoneOffset(),b=Math.floor(c/1E3)-b+
1325376E3;void 0==a||isNaN(a)||(b+=3600*a);return b},p=function(a){Pa.is_debug&&console.log(a)},la=function(){w.new_message&&(clearInterval(w.new_message),k.document.title=E,n(k).off("mousemove",la),n(k).off("focus",la),w.new_message=null,b.new_message_on_page=0,p("clear blink"))},sb=function(a){var b=function(){k.document.title=k.document.title==E?a:E};w.new_message&&(clearInterval(w.new_message),k.document.title=E,n(k).off("mousemove",la),n(k).off("focus",la),w.new_message=null,p("clear old blink"));
w.new_message||(w.new_message=setInterval(b,500),n(k).on("mousemove",la),n(k).on("focus",la),e.find("html").on("mousemove",la),e.find("html").on("focus",la),p("set blink"))},wa=function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a||"")},da="push slice apply length reverse pop _sbzq".split(" "),yb=da[0],ub=function(a){var b=a[0];a=a[da[1]](1);xb[b][da[2]](this,a)},e=null,l=
null,Z=function(a){"show"==a?(n(".sbzon").show(),b.status_widget="online"):n(".sbzon").hide()},Y=function(a){"show"==a?(n(".sbzoff").show(),b.status_widget="offline"):n(".sbzoff").hide()},I=function(a,b){if("online"==a){n(".sbzon").css({width:"100%",height:"100%"});var c=e.find("#subiz_wrapper").width(),d=e.find("#subiz_wrapper").height();n(".sbzon").css({width:c,height:d});"undefined"!=typeof b&&("undefined"!=typeof b.height&&b.height&&n(".sbzon").css("height",b.height),"undefined"!=typeof b.width&&
b.width&&n(".sbzon").css("width",b.width))}else n(".sbzoff").css({width:"100%",height:"100%"}),c=l.find("#subiz_wrapper").width(),d=l.find("#subiz_wrapper").height(),n(".sbzoff").css({width:c,height:d}),"undefined"!=typeof b&&("undefined"!=typeof b.height&&b.height&&n(".sbzoff").css("height",b.height),"undefined"!=typeof b.width&&b.width&&n(".sbzoff").css("width",b.width))},ga=function(a){"show"==a?(e.find(".button_chat_online").show(),I("online"),b.widget_window="online_compress"):e.find(".button_chat_online").hide()},
ha=function(a){"show"==a?(e.find(".widget_body").show(),I("online")):e.find(".widget_body").hide()},ia=function(a){"show"==a?(l.find(".button_chat_offline").show(),I("offline"),b.widget_window="offline_compress"):l.find(".button_chat_offline").hide()},ja=function(a){"show"==a?(l.find(".widget_body").show(),I("offline")):l.find(".widget_body").hide()},ba=function(a){"show"==a?(e.find("#subiz_chat").show(),I("online"),bb(),b.widget_window="chat"):e.find("#subiz_chat").hide()},X=function(a){"toogle"==
a?e.find(".option_form").is(":hidden")?X("show"):X("hide"):"show"==a?(ya("hide"),za("hide"),$a("hide"),Ca("show"),e.find(".option_form").show()):(e.find(".option_form").hide(),ya("hide"),za("hide"),$a("hide"),Ca("show"))},Ca=function(a){"show"==a?e.find("#option_default").show():e.find("#option_default").hide()},Xa=function(a){"show"==a?e.find("#email_transcript").parent().show():e.find("#email_transcript").parent().hide()},Ma=function(a){"show"==a?e.find("#btn_endchat").parent().show():e.find("#btn_endchat").parent().hide()},
Wa=function(a){"on"==a?(e.find(".option_config_sound i").removeClass("icon_sound_off"),e.find(".option_config_sound i").addClass("icon_sound")):(e.find(".option_config_sound i").removeClass("icon_sound"),e.find(".option_config_sound i").addClass("icon_sound_off"))},Ba=function(a){"show"==a?e.find(".endchat_form").css("display","inline"):e.find(".endchat_form").hide()},ya=function(a){"show"==a?e.find("#option_contact_details").show():e.find("#option_contact_details").hide()},za=function(a){"show"==
a?e.find("#option_edit_successful").show():e.find("#option_edit_successful").hide()},$a=function(a){"show"==a?e.find("#option_email_transcript").show():e.find("#option_email_transcript").hide()},Va=function(a){a&&0<a?e.find(".notice_new_message").html(a).show():e.find(".notice_new_message").html(0).hide()},Ya=function(a){"show"==a?e.find("#bl_rating").show():e.find("#bl_rating").hide()},aa=function(a){"show"==a?(e.find("#survey").show(),I("online"),b.widget_window="survey"):e.find("#survey").hide()},
jb=function(a){"show"==a?e.find("#v_name_survey").closest("div").show():e.find("#v_name_survey").closest("div").hide()},kb=function(a){"show"==a?e.find("#v_email_survey").closest("div").show():e.find("#v_email_survey").closest("div").hide()},lb=function(a){"show"==a?e.find("#v_phone_survey").closest("div").show():e.find("#v_phone_survey").closest("div").hide()},mb=function(a){"show"==a?e.find("#v_question_survey").closest("div").show():e.find("#v_question_survey").closest("div").hide()},nb=function(a){"show"==
a?e.find("#department").show():e.find("#department").hide()},ob=function(a){"show"==a?l.find("#v_name_offline").closest("div").show():l.find("#v_name_offline").closest("div").hide()},pb=function(a){"show"==a?l.find("#v_email_offline").closest("div").show():l.find("#v_email_offline").closest("div").hide()},qb=function(a){"show"==a?l.find("#v_phone_offline").closest("div").show():l.find("#v_phone_offline").closest("div").hide()},rb=function(a){"show"==a?(l.find("#department_edit").show(),l.find("#department").show()):
(l.find("#department_edit").hide(),l.find("#department").hide())},ra=function(a){"show"==a?(l.find("#offline_active_box").show(),I("offline"),b.widget_window="message_offline"):l.find("#offline_active_box").hide()},xa=function(a){"show"==a?(l.find("#subiz_offline").show(),I("offline"),b.widget_window="message_offline"):l.find("#subiz_offline").hide()},La=function(a){var d=c.visitor;"show"==a?(a=!0,d.name&&(a=!1,G("name",d.name)),d.email&&(a=!1,G("email",d.email)),a?(ra("hide"),xa("show")):(xa("hide"),
ra("show")),b.widget_window="message_offline"):(xa("hide"),ra("hide"))},sa=function(a){"show"==a?(l.find("#message_successful").show(),I("offline"),b.widget_window="thank_you"):l.find("#message_successful").hide()},oa=function(a,f){f=B.link(f,{stripPrefix:!0});(a=a||"")&&!a.name&&(a={name:"Agent",avatar:b.url_avatar});var g=""==a?"visitor_chat":"supporter_chat",h=e.find(".subiz_conversionin > div.visitor_chat, div.supporter_chat").last(),k="",k=h.find("label.name").html();"undefined"!=typeof a.name&&
h&&h.attr("class")==g&&a.name!=k&&(h=null);(k=e.find(".subiz_conversionin > div").last())&&"text_notice_inline"==k.attr("class")&&(h=null);h&&h.attr("class")==g?(k=""==a?'<div class="line_message"><span class="visitor_content_chat">'+f+"</span></div>":'<div class="line_message"><img src="'+Q(a.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+f+"</span></div>",h.append(k)):(k=""==a?'<div class="visitor_chat"><label class="name"><a href="javascript:;" class="visitor_name">'+
d.escape(c.visitor.name||"Me")+'</a></label><div class="line_message"><span class="visitor_content_chat">'+f+"</span></div></div>":'<div class="supporter_chat"><label class="name">'+d.escape(a.name)+'</label><div class="line_message"><img src="'+Q(a.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+f+"</span></div></div>",e.find(".subiz_conversionin").append(k));bb()},ka=function(a){"enable"==a?(e.find("input[type=text], textarea, select").removeAttr("disabled"),l.find("input[type=text], textarea, select").removeAttr("disabled")):
(e.find("input[type=text], textarea, select").attr("disabled",!0),l.find("input[type=text], textarea, select").attr("disabled",!0))},Aa=function(a){"show"==a?e.find(".message_welcome").show():e.find(".message_welcome").hide()},hb=function(a){p("loading : "+a);"show"==a?e.find("#subiz_loading").show():e.find("#subiz_loading").hide()},ib=function(a){"show"==a?l.find("#subiz_loading").show():l.find("#subiz_loading").hide()},Na=function(a){"show"==a?e.find(".widget_body_footer .btnendchat").show():e.find(".widget_body_footer .btnendchat").hide()},
Oa=function(a,b){"show"==a?d.each(c.agents,function(a){a.username==b&&(p("UI typing : found agent"),a=c.lang.online.typing.replace("{agent}",d.escape(a.name)),e.find(".text_notice").html(a).show())}):e.find(".text_notice").hide()},fa=function(a){a=d.template('<div class="text_notice_inline"><%= message %></div>',{message:a});e.find(".subiz_conversionin").append(a);bb()},Za=function(a,c){var f=d.template('<div class="chat_warning notification_widget '+("undefined"==typeof c?"":"notification_"+c)+'"><label class="name_chat_warning"><%= message %></label><a href="javascript:;" class="close_notification_widget"><i class="widget-sprites icon_actions icon_delete"></i></a></div>',
{message:a});"online"==b.status_widget?(e.find(".chat_warning").remove(),e.find(".widget_body_inner").append(f)):(l.find(".chat_warning").remove(),l.find(".widget_body_inner").append(f))},ca=function(a){"show"==a?e.find("#subiz-bubble").show():e.find("#subiz-bubble").hide()},bb=function(){var a=e.find(".subiz_conversionin")[0];"undefined"!=typeof a&&a.scrollHeight&&(a.scrollTop=a.scrollHeight)};if(0<m[da[3]])for(m[da[4]]();m[da[3]];){var zb=m[da[5]]();ub(zb)}k[da[6]]={};k[da[6]][yb]=ub})(_sbzq);
